"use strict";(self.webpackChunkbangumi_app=self.webpackChunkbangumi_app||[]).push([[5564],{"./components/Skeleton/SubjectContentSkeleton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>SubjectContentSkeleton});var __jsx=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js").createElement;function SubjectContentSkeleton(){return __jsx("div",{className:"flex min-h-[384px] animate-pulse space-x-4"},__jsx("div",{className:"flex flex-shrink-0 items-center justify-center"},__jsx("div",{className:"h-[402px] w-[288px] rounded-xl bg-neutral-6"})),__jsx("div",{className:"flex h-[420px] w-full flex-col space-y-2"},__jsx("div",{className:"flex space-x-2 p-2"},__jsx("div",{className:"h-20 w-20 flex-shrink-0 rounded-full bg-neutral-6"}),__jsx("div",{className:"h-full w-0 bg-neutral-6"}),__jsx("div",{className:"flex h-[192px] w-full flex-col justify-between"},__jsx("div",{className:"h-8 w-5/6 rounded-full bg-neutral-6"}),__jsx("div",{className:"h-8 w-full rounded-full bg-neutral-6"}),__jsx("div",{className:"h-8 w-4/5 rounded-full bg-neutral-6"}),__jsx("div",{className:"h-8 w-4/6 rounded-full bg-neutral-6"}))),__jsx("div",{className:"flex h-full flex-col justify-between px-4 py-2 pr-12 "},__jsx("div",{className:"h-8 w-5/6 rounded-full bg-neutral-6"}),__jsx("div",{className:"h-8 w-full rounded-full bg-neutral-6"}),__jsx("div",{className:"h-8 w-4/5 rounded-full bg-neutral-6"}),__jsx("div",{className:"h-8 w-4/6 rounded-full bg-neutral-6"}),__jsx("div",{className:"h-8 w-1/3 rounded-full bg-neutral-6"}))))}SubjectContentSkeleton.displayName="SubjectContentSkeleton",SubjectContentSkeleton.__docgenInfo={description:"",methods:[],displayName:"SubjectContentSkeleton"}},"./components/SubjectContent/SubjectContent.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>SubjectContent_SubjectContent});var react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),use_subject=__webpack_require__("./hooks/use-subject.ts"),use_collection=__webpack_require__("./hooks/use-collection.ts"),use_toast=__webpack_require__("./hooks/use-toast.ts"),next_auth_react=__webpack_require__("./node_modules/.pnpm/next-auth@4.20.1_nvzgbose6yf6w7ijjprgspqefi/node_modules/next-auth/react/index.js"),SubjectContentSkeleton=__webpack_require__("./components/Skeleton/SubjectContentSkeleton.tsx"),SubjectContent=__webpack_require__("./ui/primitive/SubjectContent.tsx"),Badge=__webpack_require__("./ui/primitive/Badge.tsx"),CollectionTypeSelect=__webpack_require__("./components/Select/CollectionTypeSelect.tsx"),RatingSelect=__webpack_require__("./components/Select/RatingSelect.tsx"),PlusCircleIcon=__webpack_require__("./node_modules/.pnpm/@heroicons+react@2.0.16_react@18.2.0/node_modules/@heroicons/react/20/solid/PlusCircleIcon.js"),lib=__webpack_require__("./node_modules/.pnpm/zod@3.20.6/node_modules/zod/lib/index.mjs"),use_episode=__webpack_require__("./hooks/use-episode.ts"),Button=__webpack_require__("./ui/primitive/Button.tsx"),__jsx=react.createElement;function EpisodeButton(_ref){var subject_id=_ref.subject_id,eps=_ref.eps,ep_status=_ref.ep_status,_useState=(0,react.useState)(ep_status),value=_useState[0],setValue=_useState[1],_useState2=(0,react.useState)(ep_status),prevValue=_useState2[0],setPrevValue=_useState2[1],inputRef=(0,react.useRef)(null),toast=(0,use_toast.p)(),mutateEpisode=(0,use_episode.hH)(),collectionData=(0,use_collection.d4)(subject_id).data;(0,react.useEffect)((function(){setValue(ep_status),setPrevValue(ep_status)}),[ep_status]);var episodeScheme=lib.z.number().min(0).max(eps||2e3).int();return __jsx(react.Fragment,null,collectionData&&__jsx(Button.z,{variant:{type:"outline"},className:"bg-neutral-1 hover:bg-neutral-1 active:bg-neutral-1",onClick:function onClick(){inputRef.current&&(inputRef.current.focus(),inputRef.current.select())}},__jsx("span",null,"进度:"," ",__jsx("input",{type:"number",min:0,max:eps||void 0,onChange:function onChange(e){setValue(Number(e.target.value))},value,ref:inputRef,onKeyDown:function onKeyDown(e){var _inputRef$current;if(e.stopPropagation(),"Enter"===e.key)null===(_inputRef$current=inputRef.current)||void 0===_inputRef$current||_inputRef$current.blur();else if("Escape"===e.key){var _inputRef$current2;null===(_inputRef$current2=inputRef.current)||void 0===_inputRef$current2||_inputRef$current2.blur()}},onBlur:function onBlur(){if(value!==prevValue)if(episodeScheme.safeParse(value).success){if(value-prevValue>100)return toast({type:"error",title:"修改收藏进度失败！",description:"单次最多更新 100 集。建议前往主站更新",action:{label:"前往主站",onClick:function onClick(){window.open("https://bgm.tv/subject/".concat(subject_id),"_blank")}}}),void setValue(prevValue);setPrevValue(value),mutateEpisode.mutate({subject_id,currentEp:ep_status,targetEp:value,subject_type:collectionData.subject.type,collection_type:collectionData.type})}else setValue(prevValue),toast({type:"error",title:"修改收藏进度失败！",description:"请输入 0-".concat(eps||"max"," 之间的整数。")})},className:"w-8 appearance-none bg-neutral-1 text-center outline-none selection:bg-neutral-9 selection:text-neutral-1 hover:pointer-events-auto"}),"/ ",eps),__jsx(PlusCircleIcon,{className:"ml-2 h-5 w-5",onClick:function onClick(e){e.stopPropagation();var newValue=value+1;episodeScheme.safeParse(newValue).success?(setValue(newValue),setPrevValue(value),mutateEpisode.mutate({subject_id,currentEp:ep_status,targetEp:newValue,subject_type:collectionData.subject.type,collection_type:collectionData.type})):toast({type:"error",title:"修改收藏进度失败！",description:"请输入 0-".concat(eps||"max"," 之间的整数。")})}})))}EpisodeButton.__docgenInfo={description:"",methods:[],displayName:"EpisodeButton",props:{subject_id:{required:!0,tsType:{name:"number"},description:""},eps:{required:!0,tsType:{name:"number"},description:""},ep_status:{required:!0,tsType:{name:"number"},description:""}}};try{EpisodeButton.displayName="EpisodeButton",EpisodeButton.__docgenInfo={description:"",displayName:"EpisodeButton",props:{subject_id:{defaultValue:null,description:"",name:"subject_id",required:!0,type:{name:"number"}},eps:{defaultValue:null,description:"",name:"eps",required:!0,type:{name:"number"}},ep_status:{defaultValue:null,description:"",name:"ep_status",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["components/Button/EpisodeButton.tsx#EpisodeButton"]={docgenInfo:EpisodeButton.__docgenInfo,name:"EpisodeButton",path:"components/Button/EpisodeButton.tsx#EpisodeButton"})}catch(__react_docgen_typescript_loader_error){}var MoreMenu=__webpack_require__("./components/DropdownMenu/MoreMenu.tsx"),InboxArrowDownIcon=__webpack_require__("./node_modules/.pnpm/@heroicons+react@2.0.16_react@18.2.0/node_modules/@heroicons/react/20/solid/InboxArrowDownIcon.js"),StarIcon=__webpack_require__("./node_modules/.pnpm/@heroicons+react@2.0.16_react@18.2.0/node_modules/@heroicons/react/20/solid/StarIcon.js"),ChevronDownIcon=__webpack_require__("./node_modules/.pnpm/@heroicons+react@2.0.16_react@18.2.0/node_modules/@heroicons/react/20/solid/ChevronDownIcon.js"),collectionTypeMap=__webpack_require__("./lib/map/collectionTypeMap.ts"),ratingMap=__webpack_require__("./lib/map/ratingMap.ts"),SubjectContent_jsx=react.createElement;function SubjectContent_SubjectContent(_ref){var subject_id=_ref.subject_id,toast=(0,use_toast.p)(),collectionData=(0,use_collection.d4)(subject_id).data,session=(0,next_auth_react.useSession)().data,subjectData=(0,use_subject.X)(subject_id).data,mutateCollection=(0,use_collection.SU)();return SubjectContent_jsx(react.Fragment,null,subjectData&&SubjectContent_jsx(react.Suspense,{fallback:SubjectContent_jsx(SubjectContentSkeleton.l,null)},SubjectContent_jsx(SubjectContent.cd,null,SubjectContent_jsx(SubjectContent.X3,{src:subjectData.images.medium,alt:"cover"}),SubjectContent_jsx(SubjectContent.Vp,null,SubjectContent_jsx(SubjectContent.l2,null,SubjectContent_jsx(SubjectContent.HH,{score:subjectData.rating.score,total:subjectData.rating.total}),SubjectContent_jsx(SubjectContent.qc,null),SubjectContent_jsx(SubjectContent.VC,null,subjectData.tags.map((function(_ref2){var count=_ref2.count,name=_ref2.name;return SubjectContent_jsx(Badge.C,{variant:{color:"primary"},key:name},name,SubjectContent_jsx("span",{className:"ml-1 text-neutral-11"},count))})))),SubjectContent_jsx(SubjectContent.vQ,{text:subjectData.summary}),SubjectContent_jsx(SubjectContent.JB,null,collectionData?SubjectContent_jsx(react.Fragment,null,SubjectContent_jsx(CollectionTypeSelect.S,{defaultValue:collectionTypeMap.v9[collectionTypeMap.uS.parse(collectionData.type)].name_cn,onValueChange:function onValueChange(value){var collection_type=collectionTypeMap.MG.parse(value);mutateCollection.mutate({mutateCollection:{type:Number(collection_type)},subject_id,description:value,subject_type:collectionData.subject.type,collection_type:collectionData.type})}}),SubjectContent_jsx(RatingSelect.s,{defaultValue:ratingMap.Dm[ratingMap.uh.parse(collectionData.rate)].name_cn,onValueChange:function onValueChange(value){var rating=ratingMap.RC.parse(value);mutateCollection.mutate({mutateCollection:{rate:Number(rating)},subject_id,description:value,subject_type:collectionData.subject.type,collection_type:collectionData.type})}}),SubjectContent_jsx(EpisodeButton,{subject_id:collectionData.subject_id,eps:collectionData.subject.eps,ep_status:collectionData.ep_status}),SubjectContent_jsx(MoreMenu.l,{subject_id:collectionData.subject_id,hasCollectionData:!0})):SubjectContent_jsx(react.Fragment,null,SubjectContent_jsx(Button.z,{variant:{type:"primary"},onClick:function onClick(){session?toast({type:"info",title:"收藏条目失败",description:"收藏 api 暂未开放，请先自行前往主站收藏。",action:{label:"前往主站",onClick:function onClick(){window.open("https://bgm.tv/subject/".concat(subject_id),"_blank")}}}):(0,next_auth_react.signIn)("bangumi",{redirect:!1})}},SubjectContent_jsx(InboxArrowDownIcon,{className:"mr-2 h-5 w-5"}),"收藏"),SubjectContent_jsx(Button.z,{variant:{type:"outline"},onClick:function onClick(){session?toast({type:"info",title:"请先收藏该条目"}):(0,next_auth_react.signIn)("bangumi",{redirect:!1})}},SubjectContent_jsx("span",{className:"flex items-center space-x-1"},SubjectContent_jsx(StarIcon,{className:"h-5 w-5"}),SubjectContent_jsx("span",null,"评分")),SubjectContent_jsx(ChevronDownIcon,{className:"ml-2 h-5 w-5"})),SubjectContent_jsx(MoreMenu.l,{subject_id:subjectData.id})))))))}SubjectContent_SubjectContent.__docgenInfo={description:"",methods:[],displayName:"SubjectContent",props:{subject_id:{required:!0,tsType:{name:"number"},description:""}}};try{SubjectContent_SubjectContent.displayName="SubjectContent",SubjectContent_SubjectContent.__docgenInfo={description:"",displayName:"SubjectContent",props:{subject_id:{defaultValue:null,description:"",name:"subject_id",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["components/SubjectContent/SubjectContent.tsx#SubjectContent"]={docgenInfo:SubjectContent_SubjectContent.__docgenInfo,name:"SubjectContent",path:"components/SubjectContent/SubjectContent.tsx#SubjectContent"})}catch(__react_docgen_typescript_loader_error){}},"./hooks/use-collection.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{SU:()=>useCollectionMutation,d4:()=>useCollectionData});var C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/regenerator/index.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1__),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/QueryClientProvider.mjs"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/useMutation.mjs"),_lib_api_collection__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./lib/api/collection.ts"),next_auth_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/next-auth@4.20.1_nvzgbose6yf6w7ijjprgspqefi/node_modules/next-auth/react/index.js"),_hooks_use_toast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./hooks/use-toast.ts"),zod__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/.pnpm/zod@3.20.6/node_modules/zod/lib/index.mjs"),_lib_api_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./lib/api/utils.ts");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__.Z)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function useCollectionData(subject_id){var _queryFn,session=(0,next_auth_react__WEBPACK_IMPORTED_MODULE_3__.useSession)().data,errorToast=(0,_hooks_use_toast__WEBPACK_IMPORTED_MODULE_4__.c)(),_useQuery=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_6__.a)({queryKey:["collection",subject_id,null==session?void 0:session.user.name],queryFn:(_queryFn=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.Z)(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee(){var response,message;return C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(null!=session&&session.user.name){_context.next=2;break}return _context.abrupt("return",null);case 2:return _context.prev=2,_context.next=5,fetch("https://api.bgm.tv/v0/users/".concat(session.user.name,"/collections/").concat(subject_id),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(session.accessToken)}});case 5:if(404!==(response=_context.sent).status){_context.next=8;break}return _context.abrupt("return",null);case 8:return _context.next=10,(0,_lib_api_utils__WEBPACK_IMPORTED_MODULE_5__._)(response,_lib_api_collection__WEBPACK_IMPORTED_MODULE_2__.Bx);case 10:return _context.abrupt("return",_context.sent);case 13:if(_context.prev=13,_context.t0=_context.catch(2),!(_context.t0 instanceof Error)){_context.next=19;break}return message=_context.t0.message,errorToast("获取收藏信息失败",message),_context.abrupt("return",null);case 19:case"end":return _context.stop()}}),_callee,null,[[2,13]])}))),function queryFn(){return _queryFn.apply(this,arguments)}),staleTime:1e3});return{data:_useQuery.data,isSuccess:_useQuery.isSuccess}}function useCollectionMutation(){var _onSettled,_onSuccess,_onMutate,queryClient=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_8__.NL)(),session=(0,next_auth_react__WEBPACK_IMPORTED_MODULE_3__.useSession)().data,toast=(0,_hooks_use_toast__WEBPACK_IMPORTED_MODULE_4__.p)(),errorToast=(0,_hooks_use_toast__WEBPACK_IMPORTED_MODULE_4__.c)();return(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_9__.D)({mutationFn:zod__WEBPACK_IMPORTED_MODULE_10__.z.function().args(zod__WEBPACK_IMPORTED_MODULE_10__.z.object({mutateCollection:_lib_api_collection__WEBPACK_IMPORTED_MODULE_2__.E8,description:zod__WEBPACK_IMPORTED_MODULE_10__.z.string(),subject_id:zod__WEBPACK_IMPORTED_MODULE_10__.z.number().int(),subject_type:zod__WEBPACK_IMPORTED_MODULE_10__.z.number().int(),collection_type:zod__WEBPACK_IMPORTED_MODULE_10__.z.number().int()})).implement((function(_ref2){var mutateCollection=_ref2.mutateCollection,subject_id=_ref2.subject_id;if(!session)throw new Error("请先登录！");return fetch("https://api.bgm.tv/v0/users/-/collections/".concat(subject_id),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(session.accessToken)},body:JSON.stringify(mutateCollection)}).catch((function(e){if(e instanceof Error)throw new Error(e.message)}))})),onMutate:(_onMutate=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.Z)(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee3(_ref3){var mutateCollection,subject_id,previousCollectionData,newCollectionData;return C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return mutateCollection=_ref3.mutateCollection,subject_id=_ref3.subject_id,_context3.next=3,queryClient.cancelQueries(["collection",subject_id]);case 3:return previousCollectionData=_lib_api_collection__WEBPACK_IMPORTED_MODULE_2__.Bx.parse(queryClient.getQueryData(["collection",subject_id,null==session?void 0:session.user.name])),newCollectionData=_objectSpread(_objectSpread({},previousCollectionData),mutateCollection),queryClient.setQueryData(["collection",subject_id,null==session?void 0:session.user.name],newCollectionData),_context3.abrupt("return",{previousCollectionData,newCollectionData});case 7:case"end":return _context3.stop()}}),_callee3)}))),function onMutate(_x2){return _onMutate.apply(this,arguments)}),onSuccess:(_onSuccess=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.Z)(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee4(data,_ref4){var subject_id,description,subject_type,collection_type,mutateCollection;return C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(subject_id=_ref4.subject_id,description=_ref4.description,subject_type=_ref4.subject_type,collection_type=_ref4.collection_type,mutateCollection=_ref4.mutateCollection,!data){_context4.next=4;break}return _context4.next=4,(0,_lib_api_utils__WEBPACK_IMPORTED_MODULE_5__.s)(data);case 4:return queryClient.setQueryData(["collections",subject_type,collection_type,null==session?void 0:session.user.name],(function(oldData){if(!oldData)return oldData;var oldDataParsed=_lib_api_collection__WEBPACK_IMPORTED_MODULE_2__.Jl.parse(oldData),targetPage=oldDataParsed.pages.find((function(collectionsPage){return collectionsPage.data.find((function(collection){return collection.subject_id===subject_id}))}));return targetPage&&(mutateCollection.type?targetPage.data=targetPage.data.filter((function(collection){return collection.subject_id!==subject_id})):targetPage.data=targetPage.data.map((function(collection){return collection.subject_id===subject_id&&(collection=_objectSpread(_objectSpread({},collection),mutateCollection)),collection}))),oldDataParsed})),_context4.next=7,queryClient.invalidateQueries(["collections",subject_type,mutateCollection.type,null==session?void 0:session.user.name],{refetchType:"all"});case 7:toast({type:"success",title:"修改收藏状态成功",description:"已将条目的收藏状态修改为 ".concat(description)});case 8:case"end":return _context4.stop()}}),_callee4)}))),function onSuccess(_x3,_x4){return _onSuccess.apply(this,arguments)}),onError:function onError(error,_ref5,context){var subject_id=_ref5.subject_id;error instanceof Error&&errorToast("修改收藏状态失败",error.message),context&&queryClient.setQueryData(["collection",subject_id,null==session?void 0:session.user.name],context.previousCollectionData)},onSettled:(_onSettled=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_7__.Z)(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().mark((function _callee5(data,error,_ref6){var subject_id;return C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_1___default().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return subject_id=_ref6.subject_id,_context5.next=3,queryClient.invalidateQueries({queryKey:["collection",subject_id,null==session?void 0:session.user.name],exact:!0});case 3:case"end":return _context5.stop()}}),_callee5)}))),function onSettled(_x5,_x6,_x7){return _onSettled.apply(this,arguments)})})}},"./hooks/use-episode.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{hH:()=>useEpisodeMutation,M0:()=>useEpisodesData,BN:()=>useEpisodesPageData});var defineProperty=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),asyncToGenerator=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),regenerator=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),react=__webpack_require__("./node_modules/.pnpm/next-auth@4.20.1_nvzgbose6yf6w7ijjprgspqefi/node_modules/next-auth/react/index.js"),use_toast=__webpack_require__("./hooks/use-toast.ts"),useQuery=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),useInfiniteQuery=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/useInfiniteQuery.mjs"),QueryClientProvider=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/QueryClientProvider.mjs"),useMutation=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/useMutation.mjs"),lib=__webpack_require__("./node_modules/.pnpm/zod@3.20.6/node_modules/zod/lib/index.mjs"),lib_error=__webpack_require__("./lib/error.ts"),episodesPageScheme=lib.z.object({data:lib.z.array(lib.z.object({id:lib.z.number().int(),ep:lib.z.number().int(),name:lib.z.string(),name_cn:lib.z.string(),comment:lib.z.number().int(),duration:lib.z.string(),airdate:lib.z.string()})),total:lib.z.number().int(),limit:lib.z.number().int(),offset:lib.z.number().int()}),collection=(lib.z.object({episode_id:lib.z.array(lib.z.number().int()),type:lib.z.number().int().nonnegative().max(3)}),__webpack_require__("./lib/api/collection.ts")),utils=__webpack_require__("./lib/api/utils.ts");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,defineProperty.Z)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function useEpisodesData(subject_id,limit){var _queryFn,offset=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,type=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,_useSession=(0,react.useSession)(),session=_useSession.data,toast=(0,use_toast.p)(),errorToast=(0,use_toast.c)(),_useQuery=(0,useQuery.a)({queryKey:["episodes",subject_id,offset,limit,type,null==session?void 0:session.user.name],queryFn:(_queryFn=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){var _episodesResult$data$,response,episodesResult,message;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.prev=0,-1!==offset){_context.next=3;break}return _context.abrupt("return",null);case 3:return _context.next=5,fetch("https://api.bgm.tv/v0/episodes?subject_id=".concat(subject_id,"&type=").concat(type,"&offset=").concat(offset,"&limit=").concat(limit),{headers:null===session?{}:{Authorization:"Bearer ".concat(session.accessToken)}});case 5:return response=_context.sent,_context.t0=episodesPageScheme,_context.next=9,response.clone().json();case 9:if(_context.t1=_context.sent,!(episodesResult=_context.t0.safeParse.call(_context.t0,_context.t1)).success||(null===(_episodesResult$data$=episodesResult.data.data[0])||void 0===_episodesResult$data$?void 0:_episodesResult$data$.ep)===offset+1){_context.next=14;break}return toast({type:"info",title:"无法获取剧集",description:"该条目剧集数据不符合格式。"}),_context.abrupt("return",null);case 14:return _context.next=16,(0,utils._)(response,episodesPageScheme);case 16:return _context.abrupt("return",_context.sent);case 19:if(_context.prev=19,_context.t2=_context.catch(0),!(_context.t2 instanceof Error)){_context.next=25;break}return message=_context.t2.message,errorToast("获取剧集信息失败",message),_context.abrupt("return",null);case 25:case"end":return _context.stop()}}),_callee,null,[[0,19]])}))),function queryFn(){return _queryFn.apply(this,arguments)}),staleTime:1/0,keepPreviousData:!0}),data=_useQuery.data,isSuccess=_useQuery.isSuccess;return{data,isSuccess}}function useEpisodesPageData(subject_id){var _queryFn2,limit=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,type=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,_useSession2=(0,react.useSession)(),session=_useSession2.data,errorToast=(0,use_toast.c)(),_useInfiniteQuery=(0,useInfiniteQuery.N)({queryKey:["episodes",subject_id,null==session?void 0:session.user.name],queryFn:(_queryFn2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee2(_ref){var _ref$pageParam,pageParam,page,response,message;return regenerator_default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _ref$pageParam=_ref.pageParam,pageParam=void 0===_ref$pageParam?0:_ref$pageParam,_context2.prev=1,page=lib.z.number().parse(pageParam),_context2.next=5,fetch("https://api.bgm.tv/v0/episodes?subject_id=".concat(subject_id,"&type=").concat(type,"&limit=").concat(limit,"&offset=").concat(page),{headers:null===session?{}:{Authorization:"Bearer ".concat(session.accessToken)}});case 5:return response=_context2.sent,_context2.next=8,(0,utils._)(response,episodesPageScheme);case 8:return _context2.abrupt("return",_context2.sent);case 11:if(_context2.prev=11,_context2.t0=_context2.catch(1),!(_context2.t0 instanceof Error)){_context2.next=17;break}return message=_context2.t0.message,errorToast("获取剧集信息失败",message),_context2.abrupt("return",null);case 17:case"end":return _context2.stop()}}),_callee2,null,[[1,11]])}))),function queryFn(_x){return _queryFn2.apply(this,arguments)}),getNextPageParam:function getNextPageParam(lastPage){if(lastPage)return lastPage.data.length<limit?void 0:lastPage.data[lastPage.data.length-1].ep}}),data=_useInfiniteQuery.data,isSuccess=_useInfiniteQuery.isSuccess,fetchNextPage=_useInfiniteQuery.fetchNextPage,hasNextPage=_useInfiniteQuery.hasNextPage,isFetchingNextPage=_useInfiniteQuery.isFetchingNextPage;return{data,isSuccess,fetchNextPage,hasNextPage,isFetchingNextPage}}function useEpisodeMutation(){var _onSettled,_onSuccess,_onMutate,queryClient=(0,QueryClientProvider.NL)(),session=(0,react.useSession)().data,toast=(0,use_toast.p)(),errorToast=(0,use_toast.c)();return(0,useMutation.D)({mutationFn:lib.z.function().args(lib.z.object({currentEp:lib.z.number().int(),targetEp:lib.z.number().int(),subject_id:lib.z.number().int(),subject_type:lib.z.number().int(),collection_type:lib.z.number().int()})).implement((function(_ref2){var currentEp=_ref2.currentEp,targetEp=_ref2.targetEp,subject_id=_ref2.subject_id;if(!session)throw new Error("请先登录！");if(targetEp-currentEp>100)throw new lib_error.b({description:"单次最多更新 100 集。建议前往主站更新",action:{label:"前往主站",onClick:function onClick(){window.open("https://bgm.tv/subject/".concat(subject_id),"_blank")}}});var limit=targetEp-currentEp;return fetch("https://api.bgm.tv/v0/episodes?subject_id=".concat(subject_id,"&type=0&offset=").concat(limit>0?currentEp:targetEp,"&limit=").concat(Math.abs(limit)),{headers:{Authorization:"Bearer ".concat(session.accessToken)}}).then((function(response){return response.json()})).then((function(data){var _episodes$data$,episodes=episodesPageScheme.parse(data);if((null===(_episodes$data$=episodes.data[0])||void 0===_episodes$data$?void 0:_episodes$data$.ep)!==(limit>0?currentEp:targetEp)+1)throw new lib_error.b({description:"该章节 api 未按顺序排列，请前往主站更新",action:{label:"前往主站",onClick:function onClick(){window.open("https://bgm.tv/subject/".concat(subject_id),"_blank")}}});var mutateEpisodes={episode_id:episodes.data.map((function(episode){return episode.id})),type:targetEp-currentEp>0?2:0};return fetch("https://api.bgm.tv/v0/users/-/collections/".concat(subject_id,"/episodes"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(session.accessToken)},body:JSON.stringify(mutateEpisodes)})})).catch((function(e){if(e instanceof Error){if(e instanceof lib_error.b)throw e;throw new Error(e.message)}}))})),onMutate:(_onMutate=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee3(_ref3){var targetEp,subject_id,previousCollectionData,newCollectionData;return regenerator_default().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return targetEp=_ref3.targetEp,subject_id=_ref3.subject_id,_context3.next=3,queryClient.cancelQueries(["collection",subject_id]);case 3:return previousCollectionData=collection.Bx.parse(queryClient.getQueryData(["collection",subject_id,null==session?void 0:session.user.name])),newCollectionData=_objectSpread(_objectSpread({},previousCollectionData),{},{ep_status:targetEp}),queryClient.setQueryData(["collection",subject_id,null==session?void 0:session.user.name],newCollectionData),_context3.abrupt("return",{previousCollectionData,newCollectionData});case 7:case"end":return _context3.stop()}}),_callee3)}))),function onMutate(_x2){return _onMutate.apply(this,arguments)}),onSuccess:(_onSuccess=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee4(data,_ref4){var targetEp,subject_type,collection_type,subject_id;return regenerator_default().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(targetEp=_ref4.targetEp,subject_type=_ref4.subject_type,collection_type=_ref4.collection_type,subject_id=_ref4.subject_id,!data){_context4.next=4;break}return _context4.next=4,(0,utils.s)(data);case 4:queryClient.setQueryData(["collections",subject_type,collection_type,null==session?void 0:session.user.name],(function(oldData){if(!oldData)return oldData;var oldDataParsed=collection.Jl.parse(oldData),targetPage=oldDataParsed.pages.find((function(collectionsPage){return collectionsPage.data.find((function(collection){return collection.subject_id===subject_id}))}));return targetPage&&(targetPage.data=targetPage.data.map((function(collection){return collection.subject_id===subject_id?_objectSpread(_objectSpread({},collection),{},{ep_status:targetEp}):collection}))),oldDataParsed})),toast({type:"success",title:"修改收藏进度成功",description:"已将条目的收藏进度修改为观看至第 ".concat(targetEp," 集")});case 6:case"end":return _context4.stop()}}),_callee4)}))),function onSuccess(_x3,_x4){return _onSuccess.apply(this,arguments)}),onError:function onError(error,_ref5,context){var subject_id=_ref5.subject_id;error instanceof Error&&(error instanceof lib_error.b?toast({type:"error",title:"修改收藏进度失败",description:error.description,action:error.action}):errorToast("修改收藏进度失败",error.message)),context&&queryClient.setQueryData(["collection",subject_id,null==session?void 0:session.user.name],context.previousCollectionData)},onSettled:(_onSettled=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee5(data,error,_ref6){var subject_id;return regenerator_default().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return subject_id=_ref6.subject_id,_context5.next=3,queryClient.invalidateQueries({queryKey:["collection",subject_id,null==session?void 0:session.user.name],exact:!0});case 3:case"end":return _context5.stop()}}),_callee5)}))),function onSettled(_x5,_x6,_x7){return _onSettled.apply(this,arguments)})})}},"./hooks/use-subject.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>useSubjectData});var asyncToGenerator=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),regenerator=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),useQuery=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@4.24.10_biqbaboplfbrettd7655fr4n2y/node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),lib=__webpack_require__("./node_modules/.pnpm/zod@3.20.6/node_modules/zod/lib/index.mjs"),utils=__webpack_require__("./lib/utils.ts"),constant=__webpack_require__("./lib/constant.ts"),subjectScheme=lib.z.object({id:lib.z.number().int(),date:lib.z.string().min(1).catch("未知"),images:lib.z.object({medium:lib.z.string().url().catch(constant.x),large:lib.z.string().url().catch(constant.x),common:lib.z.string().url().catch(constant.x)}),name:lib.z.string(),name_cn:lib.z.string(),tags:lib.z.array(lib.z.object({name:lib.z.string(),count:lib.z.number()})),rating:lib.z.object({score:lib.z.number(),total:lib.z.number()}),collection:lib.z.object({doing:lib.z.number(),on_hold:lib.z.number(),dropped:lib.z.number(),wish:lib.z.number(),collect:lib.z.number()}),eps:lib.z.number(),summary:lib.z.string()}),subjectTypeMap={1:{name:"book",name_cn:"书籍"},2:{name:"anime",name_cn:"动画"},3:{name:"music",name_cn:"音乐"},4:{name:"game",name_cn:"游戏"},6:{name:"real",name_cn:"三次元"}},subjectTypeKeyScheme=lib.z.preprocess((function(value){return String(value)}),lib.z.enum((0,utils.Y)(subjectTypeMap))),use_toast=(lib.z.preprocess((function(name){return(0,utils.Y)(subjectTypeMap).find((function(key){return subjectTypeMap[key].name===name}))}),subjectTypeKeyScheme),__webpack_require__("./hooks/use-toast.ts")),react=__webpack_require__("./node_modules/.pnpm/next-auth@4.20.1_nvzgbose6yf6w7ijjprgspqefi/node_modules/next-auth/react/index.js"),api_utils=__webpack_require__("./lib/api/utils.ts");function useSubjectData(subject_id){var _queryFn,session=(0,react.useSession)().data,errorToast=(0,use_toast.c)(),_useQuery=(0,useQuery.a)({queryKey:["subject",subject_id,null==session?void 0:session.user.name],queryFn:(_queryFn=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){var response,message;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(-1!==subject_id){_context.next=2;break}return _context.abrupt("return",null);case 2:return _context.prev=2,_context.next=5,fetch("https://api.bgm.tv/v0/subjects/".concat(subject_id),{headers:null===session?{}:{Authorization:"Bearer ".concat(session.accessToken)}});case 5:return response=_context.sent,_context.next=8,(0,api_utils._)(response,subjectScheme);case 8:return _context.abrupt("return",_context.sent);case 11:if(_context.prev=11,_context.t0=_context.catch(2),!(_context.t0 instanceof Error)){_context.next=17;break}return message=_context.t0.message,errorToast("获取条目信息失败",message),_context.abrupt("return",null);case 17:case"end":return _context.stop()}}),_callee,null,[[2,11]])}))),function queryFn(){return _queryFn.apply(this,arguments)}),staleTime:1/0});return{data:_useQuery.data,isSuccess:_useQuery.isSuccess}}},"./lib/api/collection.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Bx:()=>collectionScheme,E8:()=>mutateCollectionScheme,Jl:()=>collectionPagesDataScheme,X9:()=>collectionsDataScheme});var zod__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/zod@3.20.6/node_modules/zod/lib/index.mjs"),_lib_constant__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./lib/constant.ts"),collectionScheme=zod__WEBPACK_IMPORTED_MODULE_0__.z.object({subject_id:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int(),comment:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().nullable(),tags:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.string()),type:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive().lte(5),rate:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().lte(10),private:zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean(),subject:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({eps:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative(),type:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int()}),ep_status:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative()}),collectionsDataScheme=zod__WEBPACK_IMPORTED_MODULE_0__.z.object({subject_id:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int(),subject_type:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int(),comment:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().nullable(),tags:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.string()),type:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive().lte(5),rate:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().lte(10),ep_status:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative(),vol_status:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative(),private:zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean(),subject:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({id:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int(),date:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1).catch("未知"),images:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({medium:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url().catch(_lib_constant__WEBPACK_IMPORTED_MODULE_1__.x),large:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url().catch(_lib_constant__WEBPACK_IMPORTED_MODULE_1__.x),common:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url().catch(_lib_constant__WEBPACK_IMPORTED_MODULE_1__.x)}),name:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),name_cn:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),tags:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.object({name:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),count:zod__WEBPACK_IMPORTED_MODULE_0__.z.number()})),score:zod__WEBPACK_IMPORTED_MODULE_0__.z.number(),type:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int(),eps:zod__WEBPACK_IMPORTED_MODULE_0__.z.number(),collection_total:zod__WEBPACK_IMPORTED_MODULE_0__.z.number()})}),collectionsPageScheme=zod__WEBPACK_IMPORTED_MODULE_0__.z.object({data:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(collectionsDataScheme),total:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int(),limit:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int(),offset:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int()}),collectionPagesDataScheme=zod__WEBPACK_IMPORTED_MODULE_0__.z.object({pages:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(collectionsPageScheme),pageParams:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nullable().optional())}),mutateCollectionScheme=zod__WEBPACK_IMPORTED_MODULE_0__.z.object({type:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().positive().lte(5).optional(),rate:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().lte(10).optional(),ep_status:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().optional(),vol_status:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().int().nonnegative().optional(),comment:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),private:zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional(),tags:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.string()).optional()})},"./lib/api/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>handleResponse,s:()=>handleMutationResponse});var C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/regenerator/index.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__),_lib_error__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./lib/error.ts"),next_auth_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/next-auth@4.20.1_nvzgbose6yf6w7ijjprgspqefi/node_modules/next-auth/react/index.js");function handleResponse(_x,_x2){return _handleResponse.apply(this,arguments)}function _handleResponse(){return(_handleResponse=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee(response,schema){var data,result,errorResult;return C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(401!==response.status){_context.next=3;break}throw(0,next_auth_react__WEBPACK_IMPORTED_MODULE_2__.signOut)(),new Error("认证失败，请重新登录");case 3:return _context.next=5,response.json();case 5:if(data=_context.sent,(result=schema.safeParse(data)).success){_context.next=14;break}if(!(errorResult=_lib_error__WEBPACK_IMPORTED_MODULE_1__.s.safeParse(data)).success){_context.next=13;break}throw new Error(JSON.stringify(errorResult.data,null,2));case 13:throw new Error("FROM ERROR:\n".concat(errorResult.error.message,"\n\nFROM RESULT:\n").concat(result.error.message));case 14:return _context.abrupt("return",result.data);case 15:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}function handleMutationResponse(_x3){return _handleMutationResponse.apply(this,arguments)}function _handleMutationResponse(){return(_handleMutationResponse=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_3__.Z)(C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee2(response){var errorResult;return C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(401===response.status&&(0,next_auth_react__WEBPACK_IMPORTED_MODULE_2__.signOut)(),204===response.status){_context2.next=12;break}return _context2.t0=_lib_error__WEBPACK_IMPORTED_MODULE_1__.s,_context2.next=5,response.json();case 5:if(_context2.t1=_context2.sent,!(errorResult=_context2.t0.safeParse.call(_context2.t0,_context2.t1)).success){_context2.next=11;break}throw new Error(JSON.stringify(errorResult.data,null,2));case 11:throw new Error(errorResult.error.message);case 12:case"end":return _context2.stop()}}),_callee2)})))).apply(this,arguments)}},"./lib/constant.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>FALLBACK_IMAGE});var FALLBACK_IMAGE="https://avatars.githubusercontent.com/u/7521082"},"./lib/error.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>ToastError,s:()=>errorScheme});var C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/createClass.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_assertThisInitialized_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_inherits_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/inherits.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_getPrototypeOf_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_wrapNativeSuper_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js"),C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.21.0/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),zod__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/zod@3.20.6/node_modules/zod/lib/index.mjs");function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_getPrototypeOf_js__WEBPACK_IMPORTED_MODULE_0__.Z)(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_getPrototypeOf_js__WEBPACK_IMPORTED_MODULE_0__.Z)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn_js__WEBPACK_IMPORTED_MODULE_1__.Z)(this,result)}}var errorScheme=zod__WEBPACK_IMPORTED_MODULE_2__.z.object({title:zod__WEBPACK_IMPORTED_MODULE_2__.z.string(),details:zod__WEBPACK_IMPORTED_MODULE_2__.z.object({path:zod__WEBPACK_IMPORTED_MODULE_2__.z.string(),method:zod__WEBPACK_IMPORTED_MODULE_2__.z.string()}).optional(),description:zod__WEBPACK_IMPORTED_MODULE_2__.z.string()}),ToastError=function(_Error){(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_inherits_js__WEBPACK_IMPORTED_MODULE_3__.Z)(ToastError,_Error);var _super=_createSuper(ToastError);function ToastError(_ref){var _this,description=_ref.description,action=_ref.action;return(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_4__.Z)(this,ToastError),_this=_super.call(this,description),(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_5__.Z)((0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_assertThisInitialized_js__WEBPACK_IMPORTED_MODULE_6__.Z)(_this),"action",void 0),(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_5__.Z)((0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_assertThisInitialized_js__WEBPACK_IMPORTED_MODULE_6__.Z)(_this),"description",void 0),_this.action=action,_this.description=description,_this}return(0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_7__.Z)(ToastError)}((0,C_Users_z7155_WebstormProjects_dev_bangumi_dashboard_node_modules_pnpm_babel_runtime_7_21_0_node_modules_babel_runtime_helpers_esm_wrapNativeSuper_js__WEBPACK_IMPORTED_MODULE_8__.Z)(Error))}}]);